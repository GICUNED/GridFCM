---
title: "GridFCM"
output: flexdashboard::flex_dashboard
output_file: "Informe.html"
social: [ "twitter", "facebook", "menu" ]
source_code: embed
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(GridFCM)
library(OpenRepGrid)
library(knitr)
library(rgl)
library(shiny)
library(magick)
knitr::knit_hooks$set(webgl = hook_webgl)
```

REPGRID
=============================================

sidebar {.sidebar}
--------------------------------------------

TEXTO DE PRUEBA

1
--------------------------------------------

### GRID 

```{r echo=FALSE, out.width="100%", message=FALSE, warning=FALSE}
bertin(render.grid)
```

2 {.tabset .tabset-fade}
---------------------------------------------

### Biplot Simple

```{r echo=FALSE,  fig.height=9, fig.width=9, message=FALSE, warning=FALSE}
biplotSimple(render.grid, c.label.col = "darkred")
```

### Biplot 2D

```{r echo=FALSE, out.width="100%", message=FALSE, warning=FALSE}
biplot2d(render.grid, c.label.col = "darkred")
```

### Biplot 3D

```{r echo=FALSE,  fig.height=8, fig.width=8, message=FALSE, warning=FALSE, webgl=TRUE}
biplot3d(render.grid, c.label.col = "darkred")
```

CLUSTER
==========================================

1 {.sidebar}
----------------------------------------

Constructos 
-----------------------------------------

### Constructs

```{r echo=FALSE, out.width="100%", message=FALSE, warning=FALSE}
cluster(render.grid, along = 1)
```

Elementos 
-----------------------------------------

### Elements

```{r echo=FALSE, out.width="100%", message=FALSE, warning=FALSE}
cluster(render.grid, along = 2)
```


COGNITIVE INDECES {data-orientation=rows}
===========================================

sidebar {.sidebar}
--------------------------------

1 {data-height=50}
-------------------------------------

### Indeces

```{r echo=FALSE}
COR.IDEAL <- elementCor(render.grid)[1,ncol(render.grid)]
PVEFF <- indexPvaff(render.grid)
INTc <- indexIntensity(render.grid)[[1]]
INTe <- indexIntensity(render.grid)[[2]]
INT <- indexIntensity(render.grid)[[5]]
CON <- indexConflict1(render.grid)[[4]]

kable(data.frame(COR.IDEAL,PVEFF,INT,CON),col.names = c("Cor. Yo-Actual / Yo-Ideal","PVAPF","Intensidad","Conflictos"))
```

2 {.tabset .tabset-fade}
----------------------------------------

### Construct Intensity

```{r echo=FALSE}
kable(INTc, col.names = "Intensidad")
```

### Element Intensity

```{r echo=FALSE}
kable(INTe, col.names = "Intensidad")
```

Ideal Fuzzy Map {data-navmenu="FCM ANALYSIS"}
==============================================

sidebar {.sidebar}
--------------------

Idealmap {.tabset .tabset-fade}
--------------------

### Full

```{r echo=FALSE, fig.height=8, fig.width=8, message=FALSE, warning=FALSE, results='hide'}
IdealMap(render.grid,render.imp)
```

### Inconsistencies

```{r echo=FALSE, fig.height=8, fig.width=8, message=FALSE, warning=FALSE, results='hide'}
IdealMap(render.grid,render.imp, inc=TRUE)
```

Self Fuzzy Map {data-navmenu="FCM ANALYSIS" data-orientation=rows}
===========================================

sidebar {.sidebar}
-------------------


GCT
--------------------------------------

### Behavior vs Time Graph

```{r echo=FALSE, fig.height=6, fig.width=20, message=FALSE, warning=FALSE, results='hide'}
FuzzyInfer(render.grid,render.imp)
```

FCM {.tabset .tabset-fade}
---------------------------------------

### Graphopt

```{r echo=FALSE, message=FALSE, warning=FALSE, results='hide', fig.show="hold", out.width="50%",out.height="100%"}
FuzzyMap(render.grid,render.imp,niter = 1, layout = "graphopt")
FuzzyMap(render.grid,render.imp,niter = 30, layout = "graphopt")
```


### Graphopt

```{r eval=FALSE, fig.height=8, fig.width=8, message=FALSE, warning=FALSE, include=FALSE}

 dir_out <- file.path(tempdir(), "FCM-images")
dir.create(dir_out,recursive = TRUE)

iter <- c(1:30)

for (i in iter) {
  if(i<10){
  name <- paste(dir_out,"/FCM_0",i,".png",sep = "")
  }else{
  name <- paste(dir_out,"/FCM_",i,".png",sep = "") 
  }  
  
  png(name, width = 800, height = 800)
  FuzzyMap(render.grid,render.imp,niter = i, layout = "graphopt")
  mtext(paste("Iteración número",i,sep = " "))
  dev.off()
}

imgs <- list.files(dir_out, full.names = TRUE)
img_list <- lapply(imgs, image_read)

img_joined <- image_join(img_list)

FCM.gif.1 <- image_animate(img_joined, fps = 1)
```

```{r eval=FALSE, include=FALSE}
FCM.gif.1
```

### Reingold - Tilford

```{r eval=FALSE, fig.height=8, fig.width=8, message=FALSE, warning=FALSE, include=FALSE}

 dir_out <- file.path(tempdir(), "FCM-images")
dir.create(dir_out,recursive = TRUE)

iter <- c(1:30)

for (i in iter) {
  if(i<10){
  name <- paste(dir_out,"/FCM_0",i,".png",sep = "")
  }else{
  name <- paste(dir_out,"/FCM_",i,".png",sep = "") 
  }  
  
  png(name, width = 800, height = 800)
  FuzzyMap(render.grid,render.imp,niter = i, layout = "rtcircle")
  mtext(paste("Iteración número",i,sep = " "))
  dev.off()
}

imgs <- list.files(dir_out, full.names = TRUE)
img_list <- lapply(imgs, image_read)

img_joined <- image_join(img_list)

FCM.gif.2 <- image_animate(img_joined, fps = 1)
```

```{r eval=FALSE, include=FALSE}
FCM.gif.2
```


### FCM 3D

```{r echo=FALSE, fig.height=8, fig.width=8, message=FALSE, warning=FALSE, results='hide',webgl=TRUE}
rgl.clear()
FuzzyMap3D(render.grid,render.imp, niter = 1)
```

FCM Indeces {data-navmenu="FCM ANALYSIS" data-orientation=rows}
==========================================

sidebar {.sidebar}
---------------------------------------

1 {data-height=50}
----------------------------------------

### ImpGrid Indeces

```{r echo=FALSE, message=FALSE, warning=FALSE}
n.edges <- sum(render.imp != 0)
n.vertex <- ncol(render.imp)
dens <- IMPdensity(render.imp)
degree <- cbind(CentDegree(render.imp)[[1]],CentDegree(render.imp)[[2]],CentDegree(render.imp)[[3]])
close <- CentClose(render.imp)
betw <- CentBetw(render.imp)

kable(data.frame(n.vertex,n.edges, dens),col.names = c("Vértices","Aristas","Densidad"))
```

2 {.tabset .tabset-fade}
------------------------------------------------
### Degree

```{r echo=FALSE}
kable(degree, col.names = c("Salidas","Entradas","Total"))
```

### Closeness

```{r echo=FALSE}
kable(close, col.names = "Centralidad")
```

### Betweenness

```{r echo=FALSE}
kable(betw, col.names = "Centralidad")
```

